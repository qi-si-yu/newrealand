TNZ=window.TNZ||{},TNZ.Farefinder=function(a,n){if((a=a||{block_unique_id:-1,isPatternLibTest:!1}).iframeclass=a.iframeclass||"js-iframe",a.selectoptionsclass=a.selectoptionsclass||"js-finderselectoptions",a.randomiseinitial=null!=a.randomiseinitial&&!1!=!!a.randomiseinitial,a.type=a.type||"bus",a.typemode=a.typemode||null,a.isincountry=typeof a.isincountry==typeof!0==!0?a.isincountry:null,a.showdropdown=typeof a.showdropdown==typeof!0!=!0||a.showdropdown,!1==!!a.block_unique_id||-1===a.block_unique_id)throw new Error('Settings param "block_unique_id" is required.');if("airline"===a.type){if(null==a.typemode||-1==["auto","international","domestic"].indexOf(a.typemode))throw new Error('Settings param "typemode" is required when type is "airline". This should be "auto"|"international"|"domestic"');if(null==a.market)throw new Error('Settings param "market" is required when type is "airline". eg: "gb","nl","de","fr","en" etc. Used for airline iframe defaultsizes for specific markets if no size supplied on <option> tag.');if("auto"===a.typemode&&(null==a.isincountry||typeof a.isincountry==typeof!0==!1))throw new Error('Settings param "isincountry" is required when type is "airline". This should be true|false (boolean value)')}var r={$block:(n=n||jQuery)("#"+a.block_unique_id),intOrDomesticAirlineType:null};if(r.$iframe=r.$block.find("."+a.iframeclass),r.$select=r.$block.find("."+a.selectoptionsclass),"airline"===a.type&&("auto"==a.typemode?r.intOrDomesticAirlineType=a.isincountry?"domestic":"international":r.intOrDomesticAirlineType=a.typemode,a.isPatternLibTest)){var e=n("#pl_finder_testdata").data("market");e&&(a.market=e)}function o(){return r.$select.find("option").filter(function(){return this.hasAttribute("value")&&"-1"!=this.value}).map(function(){var e=this.hasAttribute("data-weighting")&&0<this.getAttribute("data-weighting").length?this.getAttribute("data-weighting"):1,t=this.hasAttribute("data-type")&&0<this.getAttribute("data-type").length?this.getAttribute("data-type"):"international",i=this.getAttribute("data-width")&&0<this.getAttribute("data-width").length?this.getAttribute("data-width"):0,n=this.getAttribute("data-height")&&0<this.getAttribute("data-height").length?this.getAttribute("data-height"):0;if("airline"===a.type&&(0===i||0===n)){var r=function(e,t){var i={height:225,width:210};switch(e){case"bus":break;case"campervan":i.height=220,i.width=210;break;case"ferry":i.height=290,i.width=220;break;case"airline":i.height=213,i.width=164,(-1!=t.indexOf("tam")||-1!=t.indexOf("airnz")||-1!=t.indexOf("thaiairways")||-1!=t.indexOf("united")&&"us"==a.market||-1!=t.indexOf("hawaiianairlines")&&"us"==a.market||-1!=t.indexOf("qantas")||-1!=t.indexOf("aircanada")||-1!=t.indexOf("garudaairlines")&&"id"==a.market||-1!=t.indexOf("koreanair")&&0<=["gb","uk","nl","de","fr"].indexOf(a.market)||-1!=t.indexOf("emirates")&&0<=["gb","uk","au","de","ie"].indexOf(a.market)||-1!=t.indexOf("singaporeair")&&0<=["gb","uk","de"].indexOf(a.market)||-1!=t.indexOf("pal"))&&(i.height=225,i.width=200),-1!=t.indexOf("qatarairways")&&0<=["de","gb","uk"].indexOf(a.market)&&(i.height=260,i.width=200)}return i}(a.type,this.value);i=r.width,n=r.height,this.setAttribute("data-width",i),this.setAttribute("data-height",n)}return{url:this.value,width:i,height:n,weighting:e,type:t}}).get()}function s(){var e={url:null,width:null,height:null,name_key:null},t=r.$select.find('option:not([value="-1"]):selected');if(0===t.length&&0===(t=r.$select.find('option:not([value="-1"]):first')).length)throw new Error("There are no valid farefinder options to display. Developer note: Check the farefinder script settings and HTML <options>. Ensure there are valid <options> elements to pick from.");return t.attr("value")&&"-1"!==t.val()&&(e.url=t.val()),e.width=t.attr("data-width"),e.height=t.attr("data-height"),e.name_key=t.attr("data-name_key"),e}function l(e){e.url&&r.$iframe.length&&(r.$iframe.attr("width",e.width).attr("height",e.height),r.$iframe.attr("src",e.url))}function d(){r.$select.chosen("destroy"),r.$select.attr("hidden",!0),r.$select.remove()}return function(){if("airline"===a.type&&function(e){r.$select.find("option").filter(function(){return this.hasAttribute("data-type")&&this.getAttribute("data-type")!=e}).map(function(){n(this).remove()})}(r.intOrDomesticAirlineType),r.aOptions=o(),a.randomiseinitial){if(!(0<r.aOptions.length))throw new Error('There were no "'+r.intOrDomesticAirlineType+'" options supplied. Please add "'+r.intOrDomesticAirlineType+'" options or specify the "typemode" to NOT be "auto". Your in NZ status is: '+a.isincountry);var e=function(e){return arr=[],e.map(function(e){for(var t=0;t<e.weighting;t++)arr.push(e)}),arr}(r.aOptions),t=function(e,t){return Math.floor(Math.random()*(t-e+1))+e}(0,e.length-1);l(e[t])}else{var i=s();i.url&&"-1"!=i.url&&l(i)}r.aOptions.length<=1?r.$select.length&&d():!1===a.showdropdown&&d(),r.$select.on("change",function(e){e.preventDefault();var t=s();if(t.url&&"-1"!==t.url){l(t);try{t.name_key&&("airline"===a.type&&(TNZ.DTM.setVar("block-farefinderSelectedAirline",t.name_key),TNZ.DTM.track("block-farefinder-airline-select-change")),"campervan"===a.type&&(TNZ.DTM.setVar("block-farefinderSelectedCampervan",t.name_key),TNZ.DTM.track("block-farefinder-campervan-select-change")))}catch(e){}}})}(),{}};