TNZ=window.TNZ||{},TNZ.SearchSuggestions=function(n,e){if(n=n||{},e=e||jQuery,!1==!!n.block_unique_id)throw new Error('Settings param "block_unique_id" is required.');if(!1==!!n.api_object)throw new Error('Settings param "api_object" is required. e.g. an instance of TNZ.SearchSuggestions');if(!1==!!n.textfield_id)throw new Error('Settings param "textfield_id" is required.');n.search_page_url=n.search_page_url||"/int/utilities/search/",n.max_results=n.max_results||5,n.min_length=n.min_length||2,n.interface_strings=n.interface_strings||{};var r=null,t={},s={},o={};s.$textfield=e("#"+n.textfield_id),TNZ.Util.isDebugMode()&&(window.searchSuggestions=window.searchSuggestions||{},window.searchSuggestions.SearchSuggestions=t,window.searchSuggestions.SearchSuggestions_settings=n,window.searchSuggestions.SearchSuggestions_suggestionObject=r,window.searchSuggestions.SearchSuggestions_api_object=n.api_object,TNZ.Util.console.log("TNZ.SearchSuggestions is exposed on window.searchSuggestions. Use the console to explore")),t.loadSuggestionsFromAPI=function(){try{s.$textfield.autocomplete({minLength:n.min_length,delay:400,source:function(e,t){r.setQuery(e.term),r.resetSuggestions(),o.setUIResponse(t);var s=new TNZ.SearchSuggestionsAPIResponse(r,i,1e4);n.api_object.runSuggestSearch(s,n.max_results)}}).autocomplete("widget").addClass("autocomplete-search")}catch(e){}};var i=function(e){if(!e.success)throw new Error(e.message);u(o.updateSuggestionsUIFromResultObject(e.suggestionObject),600,!0)},u=function(n,r,o){var i;return function(){var e=this,t=arguments,s=o&&!i;clearTimeout(i),i=setTimeout(function(){i=null,o||n.apply(e,t)},r),s&&n.apply(e,t)}};return o=new TNZ.SearchSuggestionsUI(n,e),(r=new TNZ.SuggestionObject).setURLParameters(TNZ.URL.getAll()),t.loadSuggestionsFromAPI(),t},TNZ.SearchSuggestionsUI=function(e,t){if(e=e||{},t=t||jQuery,!1==!!e.block_unique_id)throw new Error('Settings param "block_unique_id" is required.');e.search_page_url=e.search_page_url||"/int/utilities/search/",e.interface_strings=e.interface_strings||{};e.interface_strings.loading_results;var s={},n={UIResponse:!1};s.getUIResponse=function(){return n.UIResponse},s.setUIResponse=function(e){return n.UIResponse=e},s.updateSuggestionsUIFromResultObject=function(e){var t=r(e.getSuggestions());return n.UIResponse(t)};var r=function(e){var t={};return e.forEach(function(e){t[e]||(t[e]=!0)}),Object.keys(t)};return s},TNZ.SearchSuggestionsAPIResponse=function(e,t,s){e=e||null,t=t||function(){},s=s||15e3;var n={success:null,message:"",errorData:{}};n.suggestionObject=e;var r=!1,o={};return TNZ.Util.isDebugMode()&&(o.data=n,window.searchSuggestions.APIResponse=o),o.setStatus=function(e){if(r)throw new Error("TNZ.SearchSuggestionsAPIResponse.complete() has already been called. It make have completed after a timeout.");if(null==e||typeof e==typeof!0==!1)throw new Error("You must pass a boolean value.");n.success=e},o.getStatus=function(){return n.success},o.setMessage=function(e){if(r)throw new Error("TNZ.SearchSuggestionsAPIResponse.complete() has already been called. It make have completed after a timeout.");n.message=e},o.getMessage=function(){return n.message},o.setErrorData=function(e){if(r)throw new Error("TNZ.SearchSuggestionsAPIResponse.complete() has already been called. It make have completed after a timeout.");n.errorData=e},o.getErrorData=function(){return n.errorData},o.getSuggestionObject=function(){return n.suggestionObject},o.isComplete=function(){return r},o.complete=function(){if(r)throw new Error("TNZ.SearchSuggestionsAPIResponse.complete() has already been called. It make have completed after a timeout.");if(null==n.success)throw new Error("TNZ.SearchSuggestionsAPIResponse.complete() cannot be called without first setting a status of true or false");r=!0,clearTimeout(_t),t(n)},_t=setTimeout(function(){o.setStatus(!1),o.setMessage("APIResponse Timeout - the Suggestions API did not update the UI in a timely fashion."),o.complete()},s),o},TNZ.SuggestionObject=function(){var t={suggestions:[],query:"",urlparams:{}},e={};return TNZ.Util.isDebugMode()&&(e._data=t),e.getURLParameters=function(){return t.urlparams},e.setURLParameters=function(e){t.urlparams=e},e.setQuery=function(e){t.query=e},e.getQuery=function(){return t.query},e.addSuggestion=function(e){return 1<(e=e||"").length&&t.suggestions.push(e),e},e.getSuggestions=function(){return t.suggestions},e.resetSuggestions=function(){t.suggestions=[]},e._getData=function(){return t},e};