TNZ=window.TNZ||{},TNZ.SystemDeal=function(s,i,d){if(s=s||{},i=i||{},d=d||jQuery,!1==!!s.block_unique_id||0===s.block_unique_id.length)throw new Error('Settings param "block_unique_id" is required. This is the parent containing the deal html holder.');if(typeof s.bRemoveDealHolderDivIfNoDeal==typeof!0==!1)throw new Error('Settings param "bRemoveDealHolderDivIfNoDeal" is required. The needs to be a boolean value');if(s.bSwipeActive=s.bSwipeActive||!1,s.dealClassHook=s.dealClassHook||"js-systemdeal",s.dealDataEndPointAttribute=s.dealDataEndPointAttribute||"end_point_URL",!1==!!s.dealClassHook||0===s.dealClassHook.length)throw new Error('Settings param "dealClassHook" is required. It is the class used to find deal div containers. Defaults to "js-systemdeal"');if(!1==!!s.dealDataEndPointAttribute||0===s.dealDataEndPointAttribute.length)throw new Error('Settings param "dealDataEndPointAttribute" is required. It is the data attribute that contains the deal ID. Defaults to "end_point_URL"');var a={$contentBlock:d("#"+s.block_unique_id)},c=function(e,t){var i=void 0===t||t,n=a.$noResultText.clone(!0)[0].removeAttribute("hidden");e.html(n),i&&e.find(".js-finddealsnearby-btn")[0].removeAttribute("hidden")},p=function(e){e.length&&(e.remove(),a.$contentBlock.find(".js-deal-title").remove())},u=function(e,t){var i=t.$htmlElement.attr("id");t.bSwipeActive&&1<t.$htmlElement.find(".deal").length&&TNZ.Device.isMediaQuery("<phablet")?a.swipeObject[i]||function(e){var t=e,i=e.attr("id");t.wrapInner('<div class="swiper-wrapper o-slider__list" />').wrapInner('<div class="swiper-container o-slider--right-min-20" />'),t.find(".deal-wall__item").addClass("swiper-slide").addClass("o-slider__item"),t.find(".swiper-container").append('<div class="swiper-pagination o-slider__pagination o-slider__pagination--stack" />'),a.swipeObject[i]=new Swiper(t.find(".swiper-container"),{pagination:{el:".swiper-pagination",type:"bullets",clickable:!0,bulletActiveClass:"o-slider__bullet-active--secondary"},slidesPerView:"auto",paginationClickable:!0,spaceBetween:0,loop:!1,loopSlides:0}),l(e)}(t.$htmlElement):a.swipeObject[i]&&n(t.$htmlElement)},n=function(e){var t=e.attr("id");a.swipeObject[t].destroy(!0,!0),a.swipeObject[t]=void 0,$deals=e.find(".deal-wall__item"),$deals.removeClass("swiper-slide").removeClass("o-slider__item"),$deals.parent().hasClass("swiper-wrapper")&&$deals.unwrap(),$deals.parent().hasClass("swiper-container")&&$deals.unwrap(),e.find(".swiper-pagination").remove()},l=function(e){var i=e.data("renderertype")||"unknown";TNZ.JSLib.requireLoadEvent(["/thirdparty/hammer/hammer.min.js"],function(){e.find(".swiper-container").each(function(e,t){new Hammer(t).on("swipe",function(e){try{TNZ.DTM.setVar("renderertype",i),TNZ.DTM.track("block-deal-swipe")}catch(e){}})})})};return _init=function(){a.swipeObject=a.swipeObject||{};var e=a.$contentBlock.find("."+s.dealClassHook);a.$contentBlock.length&&(a.$noResultText=a.$contentBlock.find(".js-noresultstext"),a.$noResultTextBtn=a.$contentBlock.find(".js-finddealsnearby-btn"),e.each(function(){var e=d(this),t=e.data(s.dealDataEndPointAttribute);!0==!!t&&t.length&&function(e,t,i,n){var a=s.block_unique_id,l=void 0!==i.lat,r=!1,o=e;d.ajax({url:o,dataType:"json",type:"GET",data:i,cache:!0,success:function(e){t.length&&(e.success?(t.html(e.value),t[0].removeAttribute("hidden"),r=!0,u({},{$htmlElement:t,bSwipeActive:n}),"wall"==i.renderer||"wallwithimage"==i.renderer?0===e.value.length&&(l?t.find(".js-deal-item").length?c(t):c(t,!1):c(t)):TNZ.EventManager.trigger("TNZ.TravelDeal.Loaded-"+a,{element_id:t[0].getAttribute("id"),bHasDeal:r})):(s.bRemoveDealHolderDivIfNoDeal&&p(t),TNZ.EventManager.trigger("TNZ.TravelDeal.Loaded-"+a,{element_id:t[0].getAttribute("id"),bHasDeal:r})))},error:function(e){console.log("_getDeals ERROR",e)}})}(t,e,i,s.bSwipeActive)}),s.bSwipeActive&&1===e.length&&TNZ.EventManager.bind("TNZ.Resize.End",function(){u({},{$htmlElement:e,bSwipeActive:s.bSwipeActive})}))},_init(),{}};